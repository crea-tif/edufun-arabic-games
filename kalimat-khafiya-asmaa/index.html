<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>EDUFUN โข ุงุฎุชุจุงุฑ ุงูุฃุณูุงุก ุงูุญุณูู</title>
<style>
:root{
  --ink:#0f172a; --accent:#1f7ae0; --ok:#16a34a; --warn:#f59e0b; --err:#e63946;
  --glass: rgba(255,255,255,0.88);
}
html,body{height:100%}
body{
  margin:0; color:var(--ink);
  font-family:system-ui,-apple-system,"Noto Kufi Arabic","Cairo",Tahoma,Arial;
  background: linear-gradient(35deg,#55c6ff 0%, #1f7ae0 100%) fixed;
}
body::before{
  content:""; position:fixed; inset:0; z-index:-2;
  background:url('edufun-bg.png') center/cover no-repeat;
  filter:saturate(108%) contrast(110%);
}
body::after{
  content:""; position:fixed; inset:auto 0 16px 16px; width:160px; height:70px; z-index:-1;
  background:url("edufun-logo.png") no-repeat left/contain;
  opacity:.10; pointer-events:none;
}
header,.card{
  background:var(--glass);
  backdrop-filter: blur(10px);
  border:1px solid rgba(255,255,255,0.6);
  border-radius:18px;
  box-shadow:0 10px 30px rgba(31,122,224,.18);
}
.wrap{max-width:920px;margin:auto;padding:12px}
header{position:sticky;top:0;z-index:5;margin-bottom:12px}
.brandbar{display:flex;align-items:center;gap:12px}
.brand{height:56px;filter:drop-shadow(0 2px 4px rgba(0,0,0,.16))}
@media (max-width:520px){.brand{height:48px}}
h1{margin:0;font-size:22px}

.controls{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px;align-items:center}
button,select{padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,0.65);background:#fff;font-size:14px}
button.primary{background:#1f7ae0;border-color:#1f7ae0;color:#fff;box-shadow:0 6px 16px rgba(31,122,224,.25)}
button.flat{background:#f8fbff}
.stat{margin-inline-start:auto;font-size:13px;opacity:.9;display:flex;gap:10px;align-items:center}
.hearts{display:inline-flex;gap:4px}
.heart{font-size:18px;opacity:.35}
.heart.alive{opacity:1}

main .wrap{display:grid;grid-template-columns:1fr;gap:12px}
.card{padding:18px}
.q-title{font-size:clamp(18px,4.8vw,22px);margin:0 0 8px}
.name{font-size:clamp(28px,8vw,40px);font-weight:800;color:#0b3a8b;margin:6px 0 10px}
.progressbar{height:10px;background:#e7f0ff;border-radius:999px;overflow:hidden;margin:8px 0 14px;border:1px solid #e5eefc}
.progressbar>i{display:block;height:100%;width:0;background:linear-gradient(90deg,#53b3ff,#1f7ae0);transition:width .3s}
.options{display:grid;gap:10px;margin-top:6px}
.option{padding:14px;border-radius:14px;border:1px solid #e5eefc;background:#fff;text-align:right;font-size:16px}
.option.correct{background:#e8f7ee;border-color:#b7e3c8}
.option.wrong{background:#ffe8e8;border-color:#ffd1d1}
.meta{display:flex;gap:8px;align-items:center;margin-top:10px}
.meta .score{font-weight:700}
.result{margin-top:10px;min-height:24px;font-size:14px}
.footer{font-size:12px;color:#eef6ff;margin-top:6px;text-shadow:0 1px 2px rgba(0,0,0,.2);text-align:center}
.actions{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-top:10px}
.hide{display:none}
.center{text-align:center}
.big{font-size:clamp(20px,5.2vw,28px)}
</style>
</head>
<body>
<header>
  <div class="wrap">
    <div class="brandbar">
      <img class="brand" src="edufun-logo.png" alt="EDUFUN">
      <h1>ุงุฎุชุจุงุฑ ุงูุฃุณูุงุก ุงูุญุณูู</h1>
    </div>
    <div class="controls">
      <button id="btnSpeak" class="flat">๐ ุงุณุชูุน</button>
      <button id="btnShuffle" class="flat">ุฎูุท</button>
      <button id="btnRestart" class="primary">ุจุฏุก ุฌููุฉ ุฌุฏูุฏุฉ</button>
      <div class="stat">
        <div class="hearts" id="hearts">
          <span class="heart alive">โค</span>
          <span class="heart alive">โค</span>
          <span class="heart alive">โค</span>
        </div>
        <span>ุงูููุงุท: <b id="score">0</b></span>
      </div>
    </div>
  </div>
</header>

<main>
  <div class="wrap">
    <section class="card" id="panelQuiz">
      <div class="progressbar"><i id="bar"></i></div>
      <h3 class="q-title" id="qTitle">ุงุฎุชุฑ ุงููุนูู ุงูุตุญูุญ ููุงุณู:</h3>
      <div class="name" id="qName">ุงููู</div>
      <div class="options" id="options"></div>
      <div class="meta">
        <span>ุงูุณุคุงู <b id="nIdx">1</b> / <b id="nTotal">10</b></span>
        <span class="score">โข ุงูููุงุท: <span id="score2">0</span></span>
      </div>
      <div class="result" id="qResult"></div>
    </section>

    <section class="card center hide" id="panelEnd">
      <div class="big" id="endTitle">ุฃุญุณูุช! โ</div>
      <p id="endMsg">ูุชูุฌุชู 10 / 10 โ ุฑุงุฆุน!</p>
      <div class="actions">
        <button class="primary" id="playAgain">ุฌููุฉ ุฌุฏูุฏุฉ</button>
        <button class="flat" id="reviewWrong">ูุฑุงุฌุนุฉ ุงูุฃุฎุทุงุก</button>
      </div>
    </section>

    <div class="footer">EDUFUN โข ูุนูู ุนูู ุงููุงุชู ูุงูุญุงุณูุจ โข 10 ุฃุณุฆูุฉ ููู ุฌููุฉ</div>
  </div>
</main>

<script>
/* ุงูุจูุงูุงุช: ุงูุฃุณูุงุก ูุน ูุนุงูู ููุฌุฒุฉ (ููุณ ูุตุฏุฑ ุงูุจุทุงูุงุช) */
const DATA=[
{n:"ุงููู",m:"ุงุณู ุงูุฌูุงูุฉุ ุงููุนุจูุฏ ุจุญูุ ุงูุฌุงูุน ูุตูุงุช ุงูููุงู."},
{n:"ุงูุฑุญูู",m:"ูุซูุฑ ุงูุฑุญูุฉ ูู ุงูุฏููุง ูุงูุขุฎุฑุฉุ ุฑุญูุฉู ุนุงูุฉู ุจูู ุฎููู."},
{n:"ุงูุฑุญูู",m:"ูุฎุตู ุฃูููุงุกู ุจุงููุบูุฑุฉ ูุงูุฑุญูุฉ ูู ุงูุขุฎุฑุฉ."},
{n:"ุงูููู",m:"ุงููุงูู ููู ุดูุกุ ุงููุชุตุฑู ูู ูููู ููู ูุดุงุก."},
{n:"ุงููุฏูุณ",m:"ุงูููุฒูู ุนู ูู ููุต ูุนูุจ."},
{n:"ุงูุณูุงู",m:"ุงูุณุงูู ูู ูู ููุตุ ููุงูุญ ุงูุณูุงู ูุนุจุงุฏู."},
{n:"ุงููุคูู",m:"ุงููุตุฏููู ุฑุณููุ ุงููุคูููู ูุนุจุงุฏู ูู ุงูุฎูู."},
{n:"ุงูููููู",m:"ุงูุฑููุจ ุงูุดููุฏ ุนูู ุนุจุงุฏูุ ุงููุงุฆู ุนูู ูู ุดูุก."},
{n:"ุงูุนุฒูุฒ",m:"ุงูุฐู ูุง ููุบูุจ ููุง ููููุฑ."},
{n:"ุงูุฌุจุงุฑ",m:"ุงูุนุงูู ุงููุงูุฑุ ูุฌุงุจุฑ ูุณุฑ ุงูุถุนูุงุก."},
{n:"ุงููุชูุจุฑ",m:"ุงููุชุนุงูู ุนู ุตูุงุช ุงููุฎููููู."},
{n:"ุงูุฎุงูู",m:"ููุฏููุฑ ุงูุฃุดูุงุก ููุจุฏุนูุง ุนูู ุบูุฑ ูุซุงู ุณุงุจู."},
{n:"ุงูุจุงุฑุฆ",m:"ุฎุงูู ุงูุฎูู ูููููุฒูุง ุจุนุถูู ุนู ุจุนุถ."},
{n:"ุงููุตูุฑ",m:"ููุนุทู ูู ูุฎููู ุตูุฑุชู."},
{n:"ุงูุบูุงุฑ",m:"ูุซูุฑ ุงููุบูุฑุฉ ูุนุจุงุฏู ูุน ุณุชุฑ ุงูุฐูุจ."},
{n:"ุงูููุงุฑ",m:"ุงููุงูุฑ ููู ุนุจุงุฏู."},
{n:"ุงูููุงุจ",m:"ุงูุฐู ูุนุทู ุจุบูุฑ ุนูุถ."},
{n:"ุงูุฑุฒุงู",m:"ุงูุฐู ูุฑุฒู ุนุจุงุฏู ุฌููุนูุง."},
{n:"ุงููุชุงุญ",m:"ุงูุฐู ููุชุญ ุงูุฑุญูุฉ ูุงูุฑุฒู ููุญูู ุจุงูุญู."},
{n:"ุงูุนููู",m:"ุงูุนุงูู ุจูู ุดูุก."},
{n:"ุงููุงุจุถ",m:"ุงููุงุจุถ ููุฃุฑุฒุงู ูุงูุฃููุงุณ ุจุญููุชู."},
{n:"ุงูุจุงุณุท",m:"ุงูุฐู ูุจุณุท ุงูุฑุฒู ูุงูุฑุญูุฉ."},
{n:"ุงูุฎุงูุถ",m:"ูุฎูุถ ุฃูู ุงูุจุงุทู."},
{n:"ุงูุฑุงูุน",m:"ูุฑูุน ุฃูู ุงูุญู."},
{n:"ุงููุนุฒ",m:"ุงููุนุฒ ููู ูุดุงุก."},
{n:"ุงููุฐู",m:"ุงููุฐู ููู ูุดุงุก."},
{n:"ุงูุณููุน",m:"ุงูุฐู ูุณูุน ุงูุณุฑ ูุงููุฌูู."},
{n:"ุงูุจุตูุฑ",m:"ูุจุตุฑ ูู ุดูุก ุธุงูุฑูุง ูุจุงุทููุง."},
{n:"ุงูุญูู",m:"ุงูุญุงูู ุจูู ุนุจุงุฏู ุจุงููุณุท."},
{n:"ุงูุนุฏู",m:"ุงููููู ููุนุฏูุ ุงูููุฒูู ุนู ุงูุธูู."},
{n:"ุงููุทูู",m:"ุงูุฑููู ุจุนุจุงุฏูุ ูููุตู ุงูุฎูุฑ ุจูุทู."},
{n:"ุงูุฎุจูุฑ",m:"ุงูุนููู ุจุจูุงุทู ุงูุฃููุฑ."},
{n:"ุงูุญููู",m:"ูุง ูุนุฌู ูุน ูุฏุฑุชู."},
{n:"ุงูุนุธูู",m:"ุนุธูู ุงูุฐุงุช ูุงูุตูุงุช."},
{n:"ุงูุบููุฑ",m:"ูุบูุฑ ุงูุฐููุจ ุฌููุนูุง ููู ุชุงุจ."},
{n:"ุงูุดููุฑ",m:"ูุฌุฒู ุงููููู ุจูุซูุฑ ูู ุงูุซูุงุจ."},
{n:"ุงูุนูู",m:"ุงููุฑุชูุน ูุฏุฑูุง ูููุฑูุง."},
{n:"ุงููุจูุฑ",m:"ุฌูู ูุฏุฑูุ ููู ุดูุก ุฏููู ุตุบูุฑ."},
{n:"ุงูุญููุธ",m:"ูุญูุธ ุฎููู ูุฃุนูุงููู."},
{n:"ุงููููุช",m:"ุงูุฑุงุฒู ุงููุงูู ุงูุฐู ููุตู ุงูุฃููุงุช."},
{n:"ุงูุญุณูุจ",m:"ุงููุงููุ ูุงููุญุงุณูุจ ุนูู ุงูุฃุนูุงู."},
{n:"ุงูุฌููู",m:"ุงูุนุธูู ุฐู ุงูุฌูุงู ูุงูููุงู."},
{n:"ุงููุฑูู",m:"ุงูุฐู ูุนุทู ุจูุง ุญุณุงุจ."},
{n:"ุงูุฑููุจ",m:"ุงูุญุงูุธ ุงููุฑุงููุจ ููู ุดูุก."},
{n:"ุงููุฌูุจ",m:"ูุณุชุฌูุจ ุฏุนุงุก ุงูุฏุงุนูู."},
{n:"ุงููุงุณุน",m:"ูุณุน ุนููู ูุฑุญูุชู ูู ุดูุก."},
{n:"ุงูุญููู",m:"ูุง ููุนู ุฅูุง ูุญููุฉ."},
{n:"ุงููุฏูุฏ",m:"ุงููุญุจู ูุฃูููุงุฆู."},
{n:"ุงููุฌูุฏ",m:"ุงูุนุธูู ุงููุฑูู ูุซูุฑ ุงูุฅุญุณุงู."},
{n:"ุงูุจุงุนุซ",m:"ูุจุนุซ ุงูุฎูู ููุจุนุซ ุงูููู ููุทุงุนุฉ."},
{n:"ุงูุดููุฏ",m:"ุงููุทููุน ุนูู ูู ุดูุก."},
{n:"ุงูุญู",m:"ุงููุฌูุฏ ุงูุซุงุจุช."},
{n:"ุงููููู",m:"ุงููุงูู ุงููุชูููู."},
{n:"ุงูููู",m:"ูุง ูุบุงูุจู ุบุงูุจ."},
{n:"ุงููุชูู",m:"ุงูุซุงุจุช ุงูุฐู ูุง ููุญูู ุฅุนูุงุก."},
{n:"ุงูููู",m:"ูุชูููู ุฃููุฑ ุงูุตุงูุญูู."},
{n:"ุงูุญููุฏ",m:"ุงููุญููุฏ ุนูู ูู ุญุงู."},
{n:"ุงููุญุตู",m:"ุฃุญุตู ูู ุดูุก ุนุฏุฏูุง."},
{n:"ุงููุจุฏุฆ",m:"ุงููุจุชุฏุฆ ููุฎูู."},
{n:"ุงููุนูุฏ",m:"ูุนูุฏ ุงูุฎูู ุจุนุฏ ุงูููุช."},
{n:"ุงููุญูู",m:"ูุนุทู ุงูุญูุงุฉ."},
{n:"ุงููููุช",m:"ูุงุจุถ ุงูุฃุฑูุงุญ ุญูู ุงูุฃุฌู."},
{n:"ุงูุญู",m:"ูุง ูููุช ููุง ุชุฃุฎุฐู ุณูุฉ ููุง ููู."},
{n:"ุงููููู",m:"ุงููุงุฆู ุจููุณู ุงููููู ูุบูุฑู."},
{n:"ุงููุงุฌุฏ",m:"ุงูุบูู ุงูุฐู ูุง ููุชูุฑ."},
{n:"ุงููุงุฌุฏ",m:"ุงูุนุธูู ุงูููุฑู."},
{n:"ุงููุงุญุฏ",m:"ุงููุชูุฑุฏ ุจุงูุฃููููุฉ."},
{n:"ุงูุตูุฏ",m:"ุงูุณูุฏ ุงูููุตูุฏ ูู ุงูุญูุงุฆุฌ."},
{n:"ุงููุงุฏุฑ",m:"ูู ุงููุฏุฑุฉ ุงูุดุงููุฉ."},
{n:"ุงูููุชุฏุฑ",m:"ุจุงูุบ ุงููุฏุฑุฉ."},
{n:"ุงูููุฏู",m:"ููุฏูู ูู ูุดุงุก."},
{n:"ุงููุคุฎุฑ",m:"ูุคุฎุฑ ูู ูุดุงุก."},
{n:"ุงูุฃูู",m:"ูุง ุดูุก ูุจูู."},
{n:"ุงูุขุฎุฑ",m:"ูุง ุดูุก ุจุนุฏู."},
{n:"ุงูุธุงูุฑ",m:"ุธูุฑุช ุฏูุงุฆู ูุฌูุฏู."},
{n:"ุงูุจุงุทู",m:"ุงููุทููุน ุนูู ุงูุณุฑุงุฆุฑ."},
{n:"ุงููุงูู",m:"ุงููุงูู ุงููุชุตุฑู."},
{n:"ุงููุชุนุงูู",m:"ุงูููุฒูู ุนู ุงูููุต."},
{n:"ุงูุจุฑ",m:"ูุซูุฑ ุงูุฅุญุณุงู."},
{n:"ุงูุชูุงุจ",m:"ููุจู ุชูุจุฉ ุงูุชุงุฆุจูู."},
{n:"ุงูููุชูู",m:"ุงููุนุงููุจ ูููุฌุฑููู ุจุนุฏู."},
{n:"ุงูุนูู",m:"ููุญู ุงูุฐููุจ ููุชุฌุงูุฒ ุนู ุงูุณูุฆุงุช."},
{n:"ุงูุฑุคูู",m:"ุบุงูุฉ ุงูุฑุญูุฉ ูุงูุฑุฃูุฉ."},
{n:"ูุงูู ุงูููู",m:"ุงููุชุตุฑูู ูู ุงูููู."},
{n:"ุฐู ุงูุฌูุงู ูุงูุฅูุฑุงู",m:"ุตุงุญุจ ุงูุนุธูุฉ ูุงูููุงู ูุงูุฅูุนุงู."},
{n:"ุงูููุณุท",m:"ุงูุนุงุฏู ุงูููุตูู."},
{n:"ุงูุฌุงูุน",m:"ูุฌูุน ุงูุฎูู ูููู ุงูุญุณุงุจ."},
{n:"ุงูุบูู",m:"ูุง ูุญุชุงุฌ ุฅูู ุฃุญุฏ."},
{n:"ุงููุบูู",m:"ูุบูู ูู ูุดุงุก."},
{n:"ุงููุงูุน",m:"ูููุน ุงูุถุฑ ุนููู ูุดุงุก."},
{n:"ุงูุถุงุฑ",m:"ููุฏูุฑ ุงูุถุฑ ุนุฏููุง ูุงุจุชูุงุกู."},
{n:"ุงููุงูุน",m:"ููุตู ุงูุฎูุฑ ูุนุจุงุฏู."},
{n:"ุงูููุฑ",m:"ูููููุฑ ุงููููุจ ุจุงููุฏู."},
{n:"ุงููุงุฏู",m:"ููุฏู ุฅูู ุงูุตุฑุงุท ุงููุณุชููู."},
{n:"ุงูุจุฏูุน",m:"ุฃุจุฏุน ุงูุฎูู ุนูู ุบูุฑ ูุซุงู."},
{n:"ุงูุจุงูู",m:"ุงูุฏุงุฆู ุงูุฐู ูุง ูุฒูู."},
{n:"ุงููุงุฑุซ",m:"ุงูุจุงูู ุจุนุฏ ููุงุก ุงูุฎูู."},
{n:"ุงูุฑุดูุฏ",m:"ุงููุฑุดุฏ ุฅูู ุณุจูู ุงูุฑุดุงุฏ."},
{n:"ุงูุตุจูุฑ",m:"ูููู ููุง ูููู."}
];

/* ุงูุญุงูุฉ ุงูุนุงูุฉ */
const Q_TOTAL = 10;
let order = Array.from(DATA.keys());
let quizOrder = [];       // ููุงุฑุณ ุงูุฃุณุฆูุฉ ุงููุฎุชุงุฑุฉ ููุฐู ุงูุฌููุฉ
let idx = 0;              // ุฑูู ุงูุณุคุงู ุงูุญุงูู (0..Q_TOTAL-1)
let score = 0;
let lives = 3;
let wrongLog = [];        // ููุงุทูุงุน ุจุนุฏ ุงูููุงูุฉ

/* ุนูุงุตุฑ DOM */
const qName = document.getElementById('qName');
const optionsEl = document.getElementById('options');
const qResult = document.getElementById('qResult');
const nIdx = document.getElementById('nIdx');
const nTotal = document.getElementById('nTotal');
const score1 = document.getElementById('score');
const score2 = document.getElementById('score2');
const bar = document.getElementById('bar');
const heartsEl = document.getElementById('hearts');
const panelQuiz = document.getElementById('panelQuiz');
const panelEnd  = document.getElementById('panelEnd');
const endTitle  = document.getElementById('endTitle');
const endMsg    = document.getElementById('endMsg');

/* ุตูุชูุงุช ุจุณูุทุฉ */
let actx=null;
function ensureAudio(){ if(!actx){ actx=new (window.AudioContext||window.webkitAudioContext)(); } }
function tone(freq, dur=0.12, type='sine', gain=0.09, when=0){
  ensureAudio(); const t=actx.currentTime+when;
  const osc=actx.createOscillator(), g=actx.createGain();
  osc.type=type; osc.frequency.value=freq;
  g.gain.value=gain; g.gain.setValueAtTime(gain,t); g.gain.exponentialRampToValueAtTime(0.0001,t+dur);
  osc.connect(g).connect(actx.destination); osc.start(t); osc.stop(t+dur);
}
function sRight(){ tone(880,0.10,'triangle',0.11,0); tone(1320,0.12,'triangle',0.09,0.07); }
function sWrong(){ tone(220,0.12,'sawtooth',0.10,0); }
function sWin(){ [660,880,990,1320].forEach((f,i)=>tone(f,0.16,'square',0.10,i*0.08)); confetti(); }

/* ๐ ูุคุซุฑ ุจุตุฑู */
function confetti(){
  const c=document.createElement('canvas'); c.width=innerWidth; c.height=innerHeight;
  Object.assign(c.style,{position:'fixed',inset:'0',pointerEvents:'none',zIndex:9999});
  document.body.appendChild(c);
  const ctx=c.getContext('2d'), pcs=[], cols=['#ff6b6b','#ffd166','#06d6a0','#1f7ae0','#8338ec'];
  for(let i=0;i<160;i++) pcs.push({x:Math.random()*c.width,y:-20-Math.random()*200,r:6+Math.random()*6,col:cols[(Math.random()*cols.length)|0],vx:-1+Math.random()*2,vy:2+Math.random()*2,rot:Math.random()*Math.PI,vr:(-0.1+Math.random()*0.2)});
  let t=0; (function a(){ ctx.clearRect(0,0,c.width,c.height);
    pcs.forEach(p=>{ p.x+=p.vx; p.y+=p.vy; p.vy+=0.05; p.rot+=p.vr; ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.rot); ctx.fillStyle=p.col; ctx.fillRect(-p.r/2,-p.r/2,p.r,p.r); ctx.restore(); });
    if(t++<180) requestAnimationFrame(a); else c.remove();
  })();
}

/* ุฃุฏูุงุช */
function shuffle(arr){ for(let i=arr.length-1;i>0;i--){ const r=Math.floor(Math.random()*(i+1)); [arr[i],arr[r]]=[arr[r],arr[i]]; } return arr; }
function pickDistractors(correctIdx, k=3){
  const pool = order.filter(x=>x!==correctIdx);
  shuffle(pool);
  return pool.slice(0,k);
}

/* ูุงุฌูุฉ */
function drawHearts(){
  heartsEl.innerHTML='';
  for(let i=0;i<3;i++){
    const span=document.createElement('span');
    span.className='heart' + (i<lives?' alive':'');
    span.textContent='โค';
    heartsEl.appendChild(span);
  }
}

function updateProgress(){
  nIdx.textContent = String(idx+1);
  nTotal.textContent = String(Q_TOTAL);
  score1.textContent = score;
  score2.textContent = score;
  bar.style.width = ((idx)/Q_TOTAL*100).toFixed(1)+'%';
}

/* ุณุคุงู ุฌุฏูุฏ */
function buildQuestion(){
  qResult.textContent='';
  const qIdx = quizOrder[idx];
  const item = DATA[qIdx];
  qName.textContent = item.n;

  // ุชูููุฏ ุงูุฎูุงุฑุงุช
  const opts = [qIdx, ...pickDistractors(qIdx,3)];
  shuffle(opts);

  optionsEl.innerHTML='';
  opts.forEach(id=>{
    const btn=document.createElement('button');
    btn.className='option';
    btn.textContent = DATA[id].m;
    btn.onclick = ()=>{
      // ุชุนุทูู ุจููุฉ ุงูุฃุฒุฑุงุฑ
      [...document.querySelectorAll('.option')].forEach(b=>b.disabled=true);
      if(id===qIdx){
        btn.classList.add('correct'); qResult.textContent='ุฃุญุณูุช! โ'; score+=10; sRight();
      }else{
        btn.classList.add('wrong'); qResult.textContent=`ุงูุฅุฌุงุจุฉ ุงูุตุญูุญุฉ ุชุฎุต: ยซ${item.n}ยป.`; lives=Math.max(0,lives-1); sWrong();
        wrongLog.push({name:item.n, correct:item.m, chosen:DATA[id].m});
      }
      drawHearts();
      setTimeout(nextStep, 800);
    };
    optionsEl.appendChild(btn);
  });

  updateProgress();
}

/* ุงูุชูุงู ููุณุคุงู ุงูุชุงูู ุฃู ุฅููุงุก */
function nextStep(){
  idx++;
  if(lives===0){ return end(false); }
  if(idx>=Q_TOTAL){ return end(true); }
  buildQuestion();
}

/* ููุงูุฉ ุงูุฌููุฉ */
function end(win){
  panelQuiz.classList.add('hide');
  panelEnd.classList.remove('hide');
  if(win){ endTitle.textContent='ุฑุงุฆุน! ๐'; sWin(); }
  else   { endTitle.textContent='ุงูุชูุช ุงููุญุงููุงุช โ'; }
  endMsg.textContent = `ูุชูุฌุชู: ${score} / ${Q_TOTAL*10}` + (wrongLog.length? ` โ ุฃุฎุทุงุก: ${wrongLog.length}`:'');
}

/* ุจุฏุก ุฌููุฉ */
function startGame(shuffleSet=true){
  score=0; lives=3; idx=0; wrongLog=[];
  drawHearts();
  if(shuffleSet) shuffle(order);
  quizOrder = order.slice(0,Q_TOTAL);
  panelEnd.classList.add('hide');
  panelQuiz.classList.remove('hide');
  updateProgress();
  buildQuestion();
}

/* ุฃุฒุฑุงุฑ ุฃุนูู */
document.getElementById('btnRestart').onclick = ()=>startGame(true);
document.getElementById('btnShuffle').onclick = ()=>{ shuffle(order); startGame(false); };
document.getElementById('playAgain').onclick = ()=>startGame(true);
document.getElementById('reviewWrong').onclick = ()=>{
  if(!wrongLog.length){ alert('ูุง ุฃุฎุทุงุก ูู ูุฐู ุงูุฌููุฉ ๐'); return; }
  const msg = wrongLog.map((w,i)=>`${i+1}) ยซ${w.name}ยป\nโ ${w.correct}\nโ ${w.chosen}`).join('\n\n');
  alert(msg);
};
document.getElementById('btnSpeak').onclick = ()=>{
  const u=new SpeechSynthesisUtterance(qName.textContent); u.lang='ar-SA'; u.rate=0.95; speechSynthesis.cancel(); speechSynthesis.speak(u);
};

/* ุชุดุบูู ุฃููู */
startGame(true);
</script>
</body>
</html>
