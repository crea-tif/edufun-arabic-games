<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>EDUFUN â€¢ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø®ÙÙŠØ© â€“ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù„Ù‡ Ø§Ù„Ø­Ø³Ù†Ù‰</title>
<style>
:root{
  --ink:#0f172a; --accent:#1f7ae0; --ok:#16a34a; --warn:#f59e0b;
  --glass: rgba(255,255,255,0.88);
  --bg1:#b9f3d0; --bg2:#31c77a;
  --cell:44px; --vh:100vh; --head:120px;
}
html,body{height:100%}
body{
  margin:0;color:var(--ink);
  font-family:system-ui,-apple-system,"Noto Kufi Arabic","Cairo","Tajawal",Tahoma,Arial;
  background:linear-gradient(35deg,var(--bg1) 0%, var(--bg2) 100%) fixed;
}
body::after{
  content:""; position:fixed; inset:auto 0 16px 16px; width:150px; height:66px; z-index:-1;
  background:url("../edufun-logo-512.png") no-repeat left/contain;
  opacity:.10; pointer-events:none;
}
header,.card{background:var(--glass);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,0.60);border-radius:18px;box-shadow:0 10px 30px rgba(31,122,224,.18)}
.wrap{max-width:1000px;margin:auto;padding:12px}
header{margin-bottom:12px}
.brandbar{display:flex;align-items:center;gap:12px}
.brand{height:60px;border-radius:10px;filter:drop-shadow(0 1px 2px rgba(0,0,0,.18))}
@media (max-width:520px){.brand{height:52px}}
h1{margin:0;font-size:22px}
.badge{margin-inline-start:8px;font-size:12px;padding:6px 10px;border-radius:999px;background:#fff;border:1px solid #e7f0ff}
.controls{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin-top:8px}
select,button{padding:10px 12px;border:1px solid rgba(255,255,255,0.65);background:#fff;border-radius:12px;font-size:14px}
button.primary{background:#10b981;border-color:#10b981;color:#fff;box-shadow:0 6px 16px rgba(16,185,129,.25)}
main .wrap{display:grid;grid-template-columns:1fr 320px;gap:16px}
.grid-wrap{overflow:hidden;height:calc(var(--vh) - var(--head) - 28px)}
@media (max-width:900px){main .wrap{grid-template-columns:1fr}}
.grid{--n:10;display:grid;grid-template-columns:repeat(var(--n),var(--cell));grid-auto-rows:var(--cell);gap:6px;padding:6px;user-select:none;touch-action:none}
.cell{width:var(--cell);height:var(--cell);display:flex;align-items:center;justify-content:center;background:#fff;border:1px solid #eaf1fb;border-radius:14px;font-weight:800;font-size:clamp(16px,calc(var(--cell)*.55),28px);transition:transform .12s,background .3s,border-color .3s;box-shadow:0 2px 6px rgba(31,122,224,.08)}
.cell.preview{outline:2px dashed #1f7ae0}.cell.valid-preview{outline:2px solid var(--warn)}
.cell.hint{background:#fff3bf;border-color:#ffd04a;box-shadow:inset 0 0 0 2px #ffd04a33,0 2px 6px rgba(31,122,224,.08)}
.cell.found{background:#e8f7ee;border-color:#b7e3c8;color:#055a43}
.cell.flash{animation:flashOk 1s ease-in-out 3}@keyframes flashOk{0%,100%{background:#e8f7ee}50%{background:#16a34a;color:#fff;transform:scale(1.05)}}
aside.card{padding:14px}h3{margin:0 0 8px}
.target{display:flex;flex-wrap:wrap;gap:8px}
.badge2{background:#fff;border:1px solid #e5eefc;padding:8px 11px;border-radius:999px;font-size:14px;box-shadow:0 1px 3px rgba(31,122,224,.08)}
.badge2.found{background:#e8f7ee;border-color:#b7e3c8;color:#055a43}
.help{font-size:13px;color:#29425f;line-height:1.7}
.footer{font-size:12px;color:#eef6ff;margin-top:6px;text-shadow:0 1px 2px rgba(0,0,0,.2)}
hr{border:none;border-top:1px solid #e7f0ff;margin:10px 0}
</style>
</head>
<body>

<header>
  <div class="wrap">
    <div class="brandbar">
      <img class="brand" src="../edufun-logo-512.png" alt="EDUFUN">
      <h1>Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø®ÙÙŠØ© â€” <span style="color:#0f766e">Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù„Ù‡ Ø§Ù„Ø­Ø³Ù†Ù‰</span></h1>
      <span class="badge">Build r7</span>
      <a class="badge" href="../">ğŸ  Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
    </div>

    <div class="controls">
      <label>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡/Ø§Ù„Ù…Ø³ØªÙˆÙ‰:
        <select id="chunk">
          <option value="6">6</option><option value="8" selected>8</option>
          <option value="10">10</option><option value="12">12</option>
        </select>
      </label>
      <label>Ø­Ø¬Ù… Ø§Ù„Ø´Ø¨ÙƒØ©:
        <select id="size">
          <option value="8">8 Ã— 8</option><option value="10" selected>10 Ã— 10</option><option value="12">12 Ã— 12</option>
        </select>
      </label>
      <button id="regen" class="primary">Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø´Ø¨ÙƒØ©</button>
      <button id="showHints">Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ ØªÙ„Ù…ÙŠØ­Ø§Øª</button>
      <span id="status" style="margin-inline-start:auto;font-size:13px;opacity:.9"></span>
    </div>
  </div>
</header>

<main>
  <div class="wrap">
    <section class="card grid-wrap">
      <div id="grid" class="grid"></div>
      <div class="footer">Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø£ÙˆÙ„ Ø­Ø±Ù Ø«Ù… Ø§Ø³Ø­Ø¨ Ø¥Ù„Ù‰ Ø¢Ø®Ø±Ù‡. Ø§Ù„Ø§ØªØ¬Ø§Ù‡Ø§Øª Ø§Ù„Ù…Ø³Ù…ÙˆØ­Ø©: ÙŠÙ…ÙŠÙ†/ÙŠØ³Ø§Ø± Ø£Ùˆ Ø£Ø¹Ù„Ù‰/Ø£Ø³ÙÙ„. (Ù„Ø§ Ù‚Ø·Ø±ÙŠØ§Øª)</div>
    </section>

    <aside class="card">
      <h3 id="listTitle">Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ©</h3>
      <div id="targets" class="target"></div>
      <hr><div class="help">ÙˆØ§Ø¬Ù‡Ø© Ù…Ø­Ø³Ù‘Ù†Ø© Ù„Ù„Ù‡Ø§ØªÙ. Ø¥Ø°Ø§ Ù„Ù… ØªØ± Ø§Ù„Ø´Ø¨ÙƒØ© ÙƒØ§Ù…Ù„Ø©ØŒ Ù‡Ø°Ø§ Ø§Ù„Ø¥ØµØ¯Ø§Ø± r7 ÙŠØ­Ø³Ø¨ Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ù„Ù„Ø´Ø§Ø´Ø©.</div>
    </aside>
  </div>
</main>

<script>
const ALL_NAMES=["Ø§Ù„Ù„Ù‡","Ø§Ù„Ø±Ø­Ù…Ù†","Ø§Ù„Ø±Ø­ÙŠÙ…","Ø§Ù„Ù…Ù„Ùƒ","Ø§Ù„Ù‚Ø¯ÙˆØ³","Ø§Ù„Ø³Ù„Ø§Ù…","Ø§Ù„Ù…Ø¤Ù…Ù†","Ø§Ù„Ù…Ù‡ÙŠÙ…Ù†","Ø§Ù„Ø¹Ø²ÙŠØ²","Ø§Ù„Ø¬Ø¨Ø§Ø±","Ø§Ù„Ù…ØªÙƒØ¨Ø±","Ø§Ù„Ø®Ø§Ù„Ù‚","Ø§Ù„Ø¨Ø§Ø±Ø¦","Ø§Ù„Ù…ØµÙˆØ±","Ø§Ù„ØºÙØ§Ø±","Ø§Ù„Ù‚Ù‡Ø§Ø±","Ø§Ù„ÙˆÙ‡Ø§Ø¨","Ø§Ù„Ø±Ø²Ø§Ù‚","Ø§Ù„ÙØªØ§Ø­","Ø§Ù„Ø¹Ù„ÙŠÙ…","Ø§Ù„Ù‚Ø§Ø¨Ø¶","Ø§Ù„Ø¨Ø§Ø³Ø·","Ø§Ù„Ø®Ø§ÙØ¶","Ø§Ù„Ø±Ø§ÙØ¹","Ø§Ù„Ù…Ø¹Ø²","Ø§Ù„Ù…Ø°Ù„","Ø§Ù„Ø³Ù…ÙŠØ¹","Ø§Ù„Ø¨ØµÙŠØ±","Ø§Ù„Ø­ÙƒÙ…","Ø§Ù„Ø¹Ø¯Ù„","Ø§Ù„Ù„Ø·ÙŠÙ","Ø§Ù„Ø®Ø¨ÙŠØ±","Ø§Ù„Ø­Ù„ÙŠÙ…","Ø§Ù„Ø¹Ø¸ÙŠÙ…","Ø§Ù„ØºÙÙˆØ±","Ø§Ù„Ø´ÙƒÙˆØ±","Ø§Ù„Ø¹Ù„ÙŠ","Ø§Ù„ÙƒØ¨ÙŠØ±","Ø§Ù„Ø­ÙÙŠØ¸","Ø§Ù„Ù…Ù‚ÙŠØª","Ø§Ù„Ø­Ø³ÙŠØ¨","Ø§Ù„Ø¬Ù„ÙŠÙ„","Ø§Ù„ÙƒØ±ÙŠÙ…","Ø§Ù„Ø±Ù‚ÙŠØ¨","Ø§Ù„Ù…Ø¬ÙŠØ¨","Ø§Ù„ÙˆØ§Ø³Ø¹","Ø§Ù„Ø­ÙƒÙŠÙ…","Ø§Ù„ÙˆØ¯ÙˆØ¯","Ø§Ù„Ù…Ø¬ÙŠØ¯","Ø§Ù„Ø¨Ø§Ø¹Ø«","Ø§Ù„Ø´Ù‡ÙŠØ¯","Ø§Ù„Ø­Ù‚","Ø§Ù„ÙˆÙƒÙŠÙ„","Ø§Ù„Ù‚ÙˆÙŠ","Ø§Ù„Ù…ØªÙŠÙ†","Ø§Ù„ÙˆÙ„ÙŠ","Ø§Ù„Ø­Ù…ÙŠØ¯","Ø§Ù„Ù…Ø­ØµÙŠ","Ø§Ù„Ù…Ø¨Ø¯Ø¦","Ø§Ù„Ù…Ø¹ÙŠØ¯","Ø§Ù„Ù…Ø­ÙŠÙŠ","Ø§Ù„Ù…Ù…ÙŠØª","Ø§Ù„Ø­ÙŠ","Ø§Ù„Ù‚ÙŠÙˆÙ…","Ø§Ù„ÙˆØ§Ø¬Ø¯","Ø§Ù„Ù…Ø§Ø¬Ø¯","Ø§Ù„ÙˆØ§Ø­Ø¯","Ø§Ù„ØµÙ…Ø¯","Ø§Ù„Ù‚Ø§Ø¯Ø±","Ø§Ù„Ù…Ù‚ØªØ¯Ø±","Ø§Ù„Ù…Ù‚Ø¯Ù…","Ø§Ù„Ù…Ø¤Ø®Ø±","Ø§Ù„Ø£ÙˆÙ„","Ø§Ù„Ø¢Ø®Ø±","Ø§Ù„Ø¸Ø§Ù‡Ø±","Ø§Ù„Ø¨Ø§Ø·Ù†","Ø§Ù„ÙˆØ§Ù„ÙŠ","Ø§Ù„Ù…ØªØ¹Ø§Ù„ÙŠ","Ø§Ù„Ø¨Ø±","Ø§Ù„ØªÙˆØ§Ø¨","Ø§Ù„Ù…Ù†ØªÙ‚Ù…","Ø§Ù„Ø¹ÙÙˆ","Ø§Ù„Ø±Ø¤ÙˆÙ","Ù…Ø§Ù„Ùƒ Ø§Ù„Ù…Ù„Ùƒ","Ø°Ùˆ Ø§Ù„Ø¬Ù„Ø§Ù„ ÙˆØ§Ù„Ø¥ÙƒØ±Ø§Ù…","Ø§Ù„Ù…Ù‚Ø³Ø·","Ø§Ù„Ø¬Ø§Ù…Ø¹","Ø§Ù„ØºÙ†ÙŠ","Ø§Ù„Ù…ØºÙ†ÙŠ","Ø§Ù„Ù…Ø§Ù†Ø¹","Ø§Ù„Ø¶Ø§Ø±","Ø§Ù„Ù†Ø§ÙØ¹","Ø§Ù„Ù†ÙˆØ±","Ø§Ù„Ù‡Ø§Ø¯ÙŠ","Ø§Ù„Ø¨Ø¯ÙŠØ¹","Ø§Ù„Ø¨Ø§Ù‚ÙŠ","Ø§Ù„ÙˆØ§Ø±Ø«","Ø§Ù„Ø±Ø´ÙŠØ¯","Ø§Ù„ØµØ¨ÙˆØ±"];
const gridEl=document.getElementById('grid'), sizeSel=document.getElementById('size'), chunkSel=document.getElementById('chunk'), targetsEl=document.getElementById('targets'), listTitle=document.getElementById('listTitle'), statusEl=document.getElementById('status'), btnRegen=document.getElementById('regen'), btnHints=document.getElementById('showHints');
let N=+sizeSel.value, CHUNK=+chunkSel.value; let cells=[], board=[], isWord=[], targetNames=[], remaining=new Set(); let hintsOn=false;
const AR_RANDOM="Ø§Ø¨ØªØ«Ø¬Ø­Ø®Ø¯Ø°Ø±Ø²Ø³Ø´ØµØ¶Ø·Ø¸Ø¹ØºÙÙ‚ÙƒÙ„Ù…Ù†Ù‡ÙˆÙŠ";
const randLetter=()=>AR_RANDOM[Math.floor(Math.random()*AR_RANDOM.length)];
const normalize=s=>s.replace(/\s+/g,'').replace(/Ù€/g,'').replace(/[^\u0600-\u06FF]/g,'');
const idx=(r,c)=>r*N+c, inBounds=(r,c)=>r>=0&&r<N&&c>=0&&c<N;

function buildGrid(){ gridEl.innerHTML=''; cells=[]; for(let i=0;i<N*N;i++){ const d=document.createElement('div'); d.className='cell'; d.dataset.index=i; gridEl.appendChild(d); cells.push(d);} }
function tryPlace(word){
  const chars=normalize(word).split(''), L=chars.length; if(L>N) return false;
  const dirs=[{dr:0,dc:-1},{dr:1,dc:0}];
  for(let t=0;t<420;t++){
    const dir=dirs[Math.random()<.6?0:1]; let r,c;
    if(dir.dc===-1){ r=Math.floor(Math.random()*N); c=Math.floor(Math.random()*(N-1))+(L-1); }
    else{ r=Math.floor(Math.random()*(N-L)); c=Math.floor(Math.random()*N); }
    let ok=true; for(let k=0;k<L;k++){ const rr=r+dir.dr*k, cc=c+dir.dc*k; if(!inBounds(rr,cc) || (board[rr][cc] && board[rr][cc]!==chars[k])){ ok=false; break; } }
    if(!ok) continue; for(let k=0;k<L;k++){ const rr=r+dir.dr*k, cc=c+dir.dc*k; board[rr][cc]=chars[k]; isWord[rr][cc]=true; } return true;
  } return false;
}
function pickSubset(a,k){ const x=a.slice(); for(let i=x.length-1;i>0;i--){ const j=(Math.random()*(i+1))|0; [x[i],x[j]]=[x[j],x[i]];} return x.slice(0,Math.min(k,x.length)); }
function generate(){
  const eligible=ALL_NAMES.filter(n=>normalize(n).length<=N);
  let names=pickSubset(eligible, Math.min(CHUNK, eligible.length));
  names.sort((a,b)=>normalize(b).length-normalize(a).length);
  board=Array.from({length:N},()=>Array(N).fill(null));
  isWord=Array.from({length:N},()=>Array(N).fill(false));
  let placed=true; for(const nm of names){ if(!tryPlace(nm)){ placed=false; break; } }
  if(!placed){ for(let attempt=0; attempt<3 && !placed; attempt++){ names.pop(); board=Array.from({length:N},()=>Array(N).fill(null)); isWord=Array.from({length:N},()=>Array(N).fill(false)); placed=true; for(const nm of names){ if(!tryPlace(nm)){ placed=false; break; } } } }
  for(let r=0;r<N;r++)for(let c=0;c<N;c++) if(!board[r][c]) board[r][c]=randLetter();
  targetNames=names; remaining=new Set(names);
  buildGrid(); for(let r=0;r<N;r++)for(let c=0;c<N;c++) cells[idx(r,c)].textContent=board[r][c];
  renderTargets(); updateStatus(); refitAll(); applyHints();
}
function renderTargets(){ listTitle.textContent=`Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ© â€” (${targetNames.length} Ø§Ø³Ù…)`; targetsEl.innerHTML=''; targetNames.forEach(n=>{ const b=document.createElement('span'); b.className='badge2'; b.dataset.name=n; b.textContent=n; targetsEl.appendChild(b); }); }
function markBadgeFound(n){ [...targetsEl.children].forEach(x=>{ if(x.dataset.name===n) x.classList.add('found'); }); }
function updateStatus(){ statusEl.textContent=`Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${remaining.size} / ${targetNames.length}`; }
function collectLine(f,t){ if(f.r===t.r && t.c<=f.c){ const L=[]; for(let c=f.c;c>=t.c;c--) L.push({r:f.r,c}); return L; } if(f.c===t.c && t.r>=f.r){ const L=[]; for(let r=f.r;r<=t.r;r++) L.push({r,c:f.c}); return L; } return null; }
function textFrom(L){ let s=''; for(const p of L) s+=board[p.r][p.c]; return s; }
function isExact(L){ const p=textFrom(L); for(const n of remaining) if(normalize(n)===p) return n; return null; }
function isPrefix(L){ const p=textFrom(L); for(const n of remaining){ if(normalize(n).startsWith(p)) return true; } return false; }

let actx=null;
function ensureAudio(){ if(!actx){ actx=new (window.AudioContext||window.webkitAudioContext)(); } }
function tone(freq, dur=0.12, type='sine', gain=0.08, when=0){
  ensureAudio(); const t=actx.currentTime+when; const osc=actx.createOscillator(), g=actx.createGain();
  osc.type=type; osc.frequency.value=freq; g.gain.value=gain; g.gain.setValueAtTime(gain,t); g.gain.exponentialRampToValueAtTime(0.0001,t+dur);
  osc.connect(g).connect(actx.destination); osc.start(t); osc.stop(t+dur);
}
function playDing(){ tone(880,0.10,'triangle',0.10,0); tone(1320,0.12,'triangle',0.08,0.07); }
function playWin(){ [660,880,990,1320].forEach((f,i)=>tone(f,0.15,'square',0.09,i*0.08)); }

let start=null, lastPreview=[];
function posFromEl(el){ const i=+el.dataset.index; return {r:Math.floor(i/N), c:i%N}; }
function clearPreview(){ lastPreview.forEach(p=>cells[idx(p.r,p.c)].classList.remove('preview','valid-preview')); lastPreview=[]; }
function setPreview(L,exact=false){ clearPreview(); if(!L) return; L.forEach(p=>cells[idx(p.r,p.c)].classList.add(exact?'valid-preview':'preview')); lastPreview=L.slice(); }
function applyHints(){ for(let r=0;r<N;r++)for(let c=0;c<N;c++){ const i=idx(r,c), el=cells[i], found=el.classList.contains('found'); el.classList.toggle('hint', hintsOn && isWord[r][c] && !found); } }

gridEl.addEventListener('pointerdown', e=>{ const t=e.target.closest('.cell'); if(!t) return; ensureAudio(); e.preventDefault(); gridEl.setPointerCapture(e.pointerId); start=posFromEl(t); setPreview([start], false); });
gridEl.addEventListener('pointermove', e=>{
  if(!start) return; const el=document.elementFromPoint(e.clientX, e.clientY);
  const cell=(el && el.classList && el.classList.contains('cell'))? el : e.target.closest('.cell'); if(!cell) return;
  const end=posFromEl(cell); const L=collectLine(start,end); if(!L){ clearPreview(); return; }
  const exact=isExact(L); if(exact) setPreview(L,true); else if(isPrefix(L)) setPreview(L,false); else clearPreview();
});
function commitIfValid(){
  if(!start || !lastPreview.length) return;
  const exactName=isExact(lastPreview);
  if(exactName){
    remaining.delete(exactName);
    lastPreview.forEach(p=>gridEl.children[idx(p.r,p.c)].classList.add('found','flash'));
    markBadgeFound(exactName); updateStatus(); playDing();
    if(remaining.size===0){ statusEl.textContent="Ø£Ø­Ø³Ù†Øª! âœ…"; playWin(); }
    applyHints();
  }
  clearPreview(); start=null;
}
gridEl.addEventListener('pointerup', commitIfValid);
gridEl.addEventListener('pointercancel', ()=>{ clearPreview(); start=null; });

/* Responsive: --vh + --head */
function setViewportVars(){
  const vh = window.visualViewport ? window.visualViewport.height : window.innerHeight;
  document.documentElement.style.setProperty('--vh', vh+'px');
  const head = document.querySelector('header')?.getBoundingClientRect().height || 0;
  document.documentElement.style.setProperty('--head', head+'px');
}
function fitCells(){
  const wrap=gridEl.parentElement, styles=getComputedStyle(gridEl);
  const gap=parseFloat(styles.gap)||0, W=wrap.clientWidth-4, H=wrap.clientHeight-4;
  const cW=(W-gap*(N-1))/N, cH=(H-gap*(N-1))/N;
  document.documentElement.style.setProperty('--cell', Math.floor(Math.max(22, Math.min(cW,cH)))+'px');
}
function refitAll(){ setViewportVars(); fitCells(); }
addEventListener('resize', refitAll);
if(window.visualViewport){ visualViewport.addEventListener('resize', refitAll); }
new ResizeObserver(()=>refitAll()).observe(document.body);

/* UI */
btnRegen.onclick=()=>generate();
sizeSel.onchange=()=>{ N=+sizeSel.value; gridEl.style.setProperty('--n',N); generate(); };
chunkSel.onchange=()=>{ CHUNK=+chunkSel.value; generate(); };
btnHints.onclick=()=>{ hintsOn=!hintsOn; btnHints.setAttribute('aria-pressed', hintsOn?'true':'false'); applyHints(); };

/* Start */
generate(); refitAll();
</script>
</body>
</html>
