<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø®ÙÙŠØ© Ù„Ù„Ø£Ø·ÙØ§Ù„</title>
<style>
:root{
  --ink:#0f172a; --accent:#10b981; --ok:#16a34a; --warn:#f59e0b;
  --bg1:#ecfff5; --bg2:#bff7d4;
  --glass: rgba(255,255,255,0.9);
  --cell: 44px;
}
html,body{height:100%}
body{
  margin:0; color:var(--ink);
  font-family:system-ui,-apple-system,"Noto Kufi Arabic","Cairo",Tahoma,Arial;
  background: radial-gradient(1200px 700px at 70% -80%, var(--bg2), transparent 70%),
              radial-gradient(1000px 600px at -20% 50%, var(--bg2), transparent 60%),
              linear-gradient(35deg,#cffff0 0%, #b6f3d3 40%, #73e2a7 100%) fixed;
}
body::after{
  content:""; position:fixed; inset:auto 16px 16px auto; width:72px; height:72px; z-index:0;
  background:url("../edufun-logo-512.png") center/contain no-repeat; opacity:.14; pointer-events:none;
}
header,.card{
  background:var(--glass); backdrop-filter:blur(10px);
  border:1px solid rgba(255,255,255,0.65); border-radius:18px; box-shadow:0 10px 30px rgba(16,185,129,.18);
}
header{position:sticky;top:0;margin:10px 0 12px;z-index:5}
.wrap{max-width:1100px;margin:auto;padding:12px}

.brandbar{display:flex;align-items:center;gap:12px;flex-wrap:wrap}
.brand{height:56px;filter:drop-shadow(0 2px 4px rgba(0,0,0,.12))}
h1{font-size:22px;margin:0}
.sub{font-size:13px;color:#166a4b}

.controls{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin-top:8px}
select,button,.home,label.chk{
  padding:10px 12px;border:1px solid rgba(0,0,0,.06);background:#fff;border-radius:12px;font-size:14px
}
button.primary{background:#10b981;border-color:#10b981;color:#fff;box-shadow:0 6px 16px rgba(16,185,129,.25)}
.home{display:inline-flex;align-items:center;gap:8px;text-decoration:none;color:#065f46;background:#eafff2;border-color:#bbf7d0}
.home::before{content:"ğŸ "}

label.chk{display:inline-flex;align-items:center;gap:8px}
label.chk input{accent-color:#10b981; transform:scale(1.1)}

main .wrap{display:grid;grid-template-columns:1fr 320px;gap:16px}
.grid-wrap{overflow:hidden;height:var(--gridH,70vh);}
@media (max-width:900px){ header{position:static} main .wrap{grid-template-columns:1fr} }

/* grille */
.grid{
  --n:10; display:grid; grid-template-columns:repeat(var(--n),var(--cell)); grid-auto-rows:var(--cell);
  gap:6px; user-select:none; touch-action:none; padding:8px;
}
.cell{
  width:var(--cell);height:var(--cell);
  border-radius:20px;background:#fff;border:1px solid #eaf1fb;
  display:flex;align-items:center;justify-content:center;
  font-size:clamp(16px,calc(var(--cell)*.55),28px);
  font-weight:800;transition:transform .12s,background .3s,border-color .3s;
  box-shadow:0 2px 6px rgba(31,122,224,.08);
}
.cell.preview{ outline:2px dashed #10b981 }
.cell.valid-preview{ outline:2px solid var(--warn) }
.cell.hint{ background:#fff9db;border-color:#ffe08a }
.cell.found{ background:#e8f7ee;border-color:#b7e3c8;color:#055a43 }
.cell.flash{ animation:flashOk 1s ease-in-out 3 }
@keyframes flashOk{0%,100%{background:#e8f7ee}50%{background:#16a34a;color:#fff;transform:scale(1.05)}}

/* panel */
.target{display:flex;flex-wrap:wrap;gap:8px}
.badge{background:#fff;border:1px solid #e5eefc;padding:8px 11px;border-radius:999px;font-size:14px;box-shadow:0 1px 3px rgba(31,122,224,.08)}
.badge.found{background:#e8f7ee;border-color:#b7e3c8;color:#055a43}
.help{font-size:13px;color:#28555d;line-height:1.7}
.footer{font-size:12px;color:#0e5135;margin-top:6px}
hr{border:none;border-top:1px solid #e7f0ff;margin:10px 0}
</style>
</head>
<body>

<header>
  <div class="wrap">
    <div class="brandbar">
      <a class="home" href="../">Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
      <img class="brand" src="../edufun-logo-512.png" alt="EDUFUN">
      <div>
        <h1>Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø®ÙÙŠØ© Ù„Ù„Ø£Ø·ÙØ§Ù„</h1>
        <div class="sub">Ù…Ø³ØªÙˆÙŠØ§Øª Ù…Ù…ØªØ¹Ø© ÙˆØ³Ù‡Ù„Ø©</div>
      </div>
    </div>

    <div class="controls">
      <label>Ø§Ù„ÙØ¦Ø©:
        <select id="category"></select>
      </label>
      <label>Ø§Ù„ØµØ¹ÙˆØ¨Ø©:
        <select id="difficulty">
          <option value="easy">Ø³Ù‡Ù„</option>
          <option value="med">Ù…ØªÙˆØ³Ø·</option>
          <option value="hard">ØµØ¹Ø¨</option>
        </select>
      </label>
      <label>Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙ„Ù…Ø§Øª/Ø§Ù„Ù…Ø³ØªÙˆÙ‰:
        <select id="chunk">
          <option value="6" selected>6</option><option value="8">8</option><option value="10">10</option>
        </select>
      </label>
      <label>Ø­Ø¬Ù… Ø§Ù„Ø´Ø¨ÙƒØ©:
        <select id="size">
          <option value="8">8 Ã— 8</option><option value="10" selected>10 Ã— 10</option><option value="12">12 Ã— 12</option>
        </select>
      </label>
      <label class="chk"><input type="checkbox" id="diag"> Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ù‚Ø·Ø±ÙŠØ§Øª</label>
      <button id="regen" class="primary">Ø´Ø¨ÙƒØ© Ø¬Ø¯ÙŠØ¯Ø©</button>
      <button id="showHints">ØªÙ„Ù…ÙŠØ­Ø§Øª</button>
    </div>
  </div>
</header>

<main>
  <div class="wrap">
    <section class="card grid-wrap">
      <div id="grid" class="grid"></div>
      <div class="footer" id="status"></div>
    </section>

    <aside class="card">
      <h3 id="listTitle">Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ©</h3>
      <div id="targets" class="target"></div>
      <hr>
      <div class="help">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø±Ù Ø§Ù„Ø£ÙˆÙ„ Ø«Ù… Ø§Ø³Ø­Ø¨ Ø¥Ù„Ù‰ Ø§Ù„Ø£Ø®ÙŠØ±. Ø§Ù„Ø§ØªØ¬Ø§Ù‡Ø§Øª: ÙŠÙ…ÙŠÙ†/ÙŠØ³Ø§Ø± â†”ØŒ Ø£Ø¹Ù„Ù‰/Ø£Ø³ÙÙ„ â†•ØŒ ÙˆØ§Ù„Ù‚Ø·Ø±ÙŠØ§Øª Ø¥Ø°Ø§ ÙÙØ¹Ù‘Ù„Øª.</div>
    </aside>
  </div>
</main>

<script>
/* â€”â€”â€” Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„ÙƒÙ„Ù…Ø§Øª â€”â€”â€” */
const CATEGORIES={
  "Ø§Ù„Ø£Ù„ÙˆØ§Ù†":["Ø£Ø­Ù…Ø±","Ø£Ø²Ø±Ù‚","Ø£ØµÙØ±","ÙˆØ±Ø¯ÙŠ","Ø¨Ù†ÙØ³Ø¬ÙŠ","Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ","Ø£Ø®Ø¶Ø±","Ø£Ø¨ÙŠØ¶","Ø£Ø³ÙˆØ¯","Ø¨Ù†ÙŠ","Ø±Ù…Ø§Ø¯ÙŠ"],
  "Ø§Ù„Ø­ÙŠÙˆØ§Ù†Ø§Øª":["Ù‚Ø·Ø©","ÙƒÙ„Ø¨","Ø­ØµØ§Ù†","Ø¹ØµÙÙˆØ±","Ø³Ù…Ùƒ","Ù†Ø­Ù„","Ø¨Ù‚Ø±Ø©","Ø£Ø³Ø¯","Ø°Ø¦Ø¨","ÙÙŠÙ„","Ø£Ø±Ù†Ø¨","Ø²Ø±Ø§ÙØ©"],
  "Ø§Ù„Ø®Ø¶Ø§Ø±":["Ø·Ù…Ø§Ø·Ù…","Ø®ÙŠØ§Ø±","Ø¨Ø·Ø§Ø·Ø³","Ø¬Ø²Ø±","ÙÙ„ÙÙ„","Ø¨ØµÙ„","Ø«ÙˆÙ…","Ø®Ø³","Ø³Ø¨Ø§Ù†Ø®","Ø¨Ø§Ø°Ù†Ø¬Ø§Ù†"],
  "Ø§Ù„ÙÙˆØ§ÙƒÙ‡":["ØªÙØ§Ø­","Ù…ÙˆØ²","Ø¨Ø±ØªÙ‚Ø§Ù„","Ø¹Ù†Ø¨","ÙƒØ±Ø²","ÙƒÙ…Ø«Ø±Ù‰","Ø®ÙˆØ®","Ø±Ù…Ø§Ù†","Ø¨Ø·ÙŠØ®","ÙØ±Ø§ÙˆÙ„Ø©"],
  "Ø§Ù„Ø£Ø´ÙƒØ§Ù„":["Ø¯Ø§Ø¦Ø±Ø©","Ù…Ø±Ø¨Ø¹","Ù…Ø«Ù„Ø«","Ù…Ø³ØªØ·ÙŠÙ„","Ù†Ø¬Ù…Ø©","Ù‚Ù„Ø¨","Ø¨ÙŠØ¶Ø§ÙˆÙŠ"],
  "ÙˆØ³Ø§Ø¦Ù„ Ø§Ù„Ù†Ù‚Ù„":["Ø³ÙŠØ§Ø±Ø©","Ø­Ø§ÙÙ„Ø©","Ù‚Ø·Ø§Ø±","Ø·Ø§Ø¦Ø±Ø©","Ø¯Ø±Ø§Ø¬Ø©","Ø³ÙÙŠÙ†Ø©","Ù…ØªØ±Ùˆ"],
  "Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠØ©":["Ù‚Ù„Ù…","Ù…Ù…Ø­Ø§Ø©","Ù…Ø³Ø·Ø±Ø©","Ø¯ÙØªØ±","ÙƒØªØ§Ø¨","Ø­Ù‚ÙŠØ¨Ø©","Ù…Ø¨Ø±Ø§Ø©","Ù…Ø³Ø·Ø±ÙŠÙ†"]
};

const AR_RANDOM="Ø§Ø¨ØªØ«Ø¬Ø­Ø®Ø¯Ø°Ø±Ø²Ø³Ø´ØµØ¶Ø·Ø¸Ø¹ØºÙÙ‚ÙƒÙ„Ù…Ù†Ù‡ÙˆÙŠ";
const randLetter=()=>AR_RANDOM[Math.floor(Math.random()*AR_RANDOM.length)];
const normalize=s=>s.replace(/\s+/g,'').replace(/Ù€/g,'').replace(/[^\u0600-\u06FF]/g,'');

const gridEl=document.getElementById('grid'),
statusEl=document.getElementById('status'),
targetsEl=document.getElementById('targets'),
listTitle=document.getElementById('listTitle');

const selCat=document.getElementById('category'),
selDiff=document.getElementById('difficulty'),
selSize=document.getElementById('size'),
selChunk=document.getElementById('chunk'),
chkDiag=document.getElementById('diag'),
btnHints=document.getElementById('showHints'),
btnRegen=document.getElementById('regen');

Object.keys(CATEGORIES).forEach(k=>{ const o=document.createElement('option'); o.value=k; o.textContent=k; selCat.appendChild(o); });

let N=+selSize.value, CHUNK=+selChunk.value, allowDiag=false, hintsOn=false;
let cells=[], board=[], isWord=[], targets=[], remaining=new Set();

const idx=(r,c)=>r*N+c, inBounds=(r,c)=>r>=0&&r<N&&c>=0&&c<N;

/* UI */
function buildGrid(){
  gridEl.style.setProperty('--n',N);
  gridEl.innerHTML=''; cells=[];
  for(let i=0;i<N*N;i++){const d=document.createElement('div');d.className='cell';d.dataset.index=i;gridEl.appendChild(d);cells.push(d);}
}

/* placement selon allowDiag */
function directions(){
  const hv=[{dr:0,dc:-1},{dr:0,dc:1},{dr:1,dc:0},{dr:-1,dc:0}];
  const diag=[{dr:1,dc:1},{dr:1,dc:-1},{dr:-1,dc:1},{dr:-1,dc:-1}];
  return allowDiag ? hv.concat(diag) : hv;
}
function tryPlace(word){
  const chars=normalize(word).split(''), L=chars.length;
  if(L>N) return false;
  const dirs=directions();
  for(let t=0;t<520;t++){
    const dir=dirs[(Math.random()*dirs.length)|0];
    let r=Math.floor(Math.random()*N), c=Math.floor(Math.random()*N);
    /* recalc start to keep inside */
    if(dir.dc===1)  c=Math.floor(Math.random()*(N-L+1));
    if(dir.dc===-1) c=(Math.floor(Math.random()*(N-L+1)))+(L-1);
    if(dir.dr===1)  r=Math.floor(Math.random()*(N-L+1));
    if(dir.dr===-1) r=(Math.floor(Math.random()*(N-L+1)))+(L-1);

    let ok=true;
    for(let k=0;k<L;k++){
      const rr=r+dir.dr*k, cc=c+dir.dc*k;
      if(!inBounds(rr,cc) || (board[rr][cc] && board[rr][cc]!==chars[k])){ ok=false; break; }
    }
    if(!ok) continue;
    for(let k=0;k<L;k++){ const rr=r+dir.dr*k, cc=c+dir.dc*k; board[rr][cc]=chars[k]; isWord[rr][cc]=true; }
    return true;
  }
  return false;
}
function pickSubset(a,k){const x=a.slice();for(let i=x.length-1;i>0;i--){const j=(Math.random()*(i+1))|0;[x[i],x[j]]=[x[j],x[i]]}return x.slice(0,Math.min(k,x.length))}

/* gÃ©nÃ©ration */
function generate(){
  const pool=CATEGORIES[selCat.value]||[];
  const base=pool.slice();
  /* difficultÃ© â†’ taille/longueur ØªÙ‚Ø±ÙŠØ¨Ù‹Ø§ */
  let desired=CHUNK;
  if(selDiff.value==='med') desired=Math.min(CHUNK+1, base.length);
  if(selDiff.value==='hard') desired=Math.min(CHUNK+2, base.length);

  const eligible=base.filter(n=>normalize(n).length<=N);
  let words=pickSubset(eligible, desired).sort((a,b)=>normalize(b).length-normalize(a).length);

  board=Array.from({length:N},()=>Array(N).fill(null));
  isWord=Array.from({length:N},()=>Array(N).fill(false));

  let placed=true;
  for(const w of words){ if(!tryPlace(w)){ placed=false; break; } }
  if(!placed){
    for(let attempt=0;attempt<4 && !placed;attempt++){
      words.pop();
      board=Array.from({length:N},()=>Array(N).fill(null));
      isWord=Array.from({length:N},()=>Array(N).fill(false));
      placed=true;
      for(const w of words){ if(!tryPlace(w)){ placed=false; break; } }
    }
  }
  for(let r=0;r<N;r++)for(let c=0;c<N;c++) if(!board[r][c]) board[r][c]=randLetter();

  targets=words; remaining=new Set(words);
  buildGrid(); for(let r=0;r<N;r++)for(let c=0;c<N;c++) cells[idx(r,c)].textContent=board[r][c];
  renderTargets(); updateStatus(); refitAll(); applyHints();
}
function renderTargets(){
  listTitle.textContent=`Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ© (${targets.length}) â€” ${selCat.value}`;
  targetsEl.innerHTML='';
  targets.forEach(n=>{ const b=document.createElement('span'); b.className='badge'; b.dataset.name=n; b.textContent=n; targetsEl.appendChild(b); });
}
const markBadgeFound = n => { [...targetsEl.children].forEach(x=>{ if(x.dataset.name===n) x.classList.add('found'); }); }
const updateStatus    = ()=> statusEl.textContent=`Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${remaining.size} / ${targets.length}`;

/* matching */
function collectLine(f,t){
  const L=[]; const dr=Math.sign(t.r-f.r), dc=Math.sign(t.c-f.c);
  const adr=Math.abs(t.r-f.r), adc=Math.abs(t.c-f.c);
  if(allowDiag){
    if(dr===0 && adc>0){ for(let c=f.c;c!==t.c- Math.sign(dc); c+=-1*dc){} } /* just to keep symmetry */
    const isHV=(dr===0 || dc===0), isD=(adr===adc && adr>0);
    if(!isHV && !isD) return null;
  }else{
    if(!(f.r===t.r || f.c===t.c)) return null;
  }
  const stepR = f.r===t.r? 0 : (t.r>f.r? 1:-1);
  const stepC = f.c===t.c? 0 : (t.c<f.c? -1: 1);
  const len = Math.max(Math.abs(t.r-f.r), Math.abs(t.c-f.c))+1;
  if(stepR===0 && stepC===-1){ for(let c=f.c;c>=t.c;c--) L.push({r:f.r,c}); return L; }
  if(stepC===0 && stepR===1){ for(let r=f.r;r<=t.r;r++) L.push({r,c:f.c}); return L; }
  if(allowDiag){
    /* 8 directions + HV mirrored */
    let r=f.r,c=f.c; for(let k=0;k<len;k++){ L.push({r,c}); r+=stepR; c+=stepC; }
    return L;
  }
  return null;
}
const textFrom = L => L.map(p=>board[p.r][p.c]).join('');
const isExact = L => { const p=textFrom(L); for(const n of remaining) if(normalize(n)===p) return n; return null; }
const isPrefix = L => { const p=textFrom(L); for(const n of remaining) if(normalize(n).startsWith(p)) return true; return false; }

/* audio+confettis */
let actx=null;
const ensureAudio=()=>{ if(!actx) actx=new (window.AudioContext||window.webkitAudioContext)(); }
function tone(freq, dur=0.12, type='sine', gain=0.08, when=0){
  ensureAudio(); const t=actx.currentTime+when;
  const osc=actx.createOscillator(), g=actx.createGain();
  osc.type=type; osc.frequency.value=freq;
  g.gain.value=gain; g.gain.setValueAtTime(gain,t); g.gain.exponentialRampToValueAtTime(0.0001,t+dur);
  osc.connect(g).connect(actx.destination); osc.start(t); osc.stop(t+dur);
}
const clickFx=()=>tone(520,0.06,'triangle',0.09,0);
const playDing=()=>{ tone(880,0.10,'triangle',0.10,0); tone(1320,0.12,'triangle',0.08,0.07); }
function playWin(){ [660,880,990,1320].forEach((f,i)=>tone(f,0.15,'square',0.09,i*0.08)); confettiBurst(); }
function confettiBurst(){
  const c=document.createElement('canvas'); c.width=innerWidth; c.height=innerHeight;
  Object.assign(c.style,{position:'fixed',inset:'0',pointerEvents:'none',zIndex:9999});
  document.body.appendChild(c);
  const ctx=c.getContext('2d'), pcs=[], cols=['#ff6b6b','#ffd166','#06d6a0','#10b981','#1f7ae0','#9333ea'];
  for(let i=0;i<160;i++) pcs.push({x:Math.random()*c.width,y:-20-Math.random()*200,r:6+Math.random()*6,col:cols[(Math.random()*cols.length)|0],vx:-1+Math.random()*2,vy:2+Math.random()*2,rot:Math.random()*Math.PI,vr:(-0.1+Math.random()*0.2)});
  let t=0; (function a(){ ctx.clearRect(0,0,c.width,c.height);
    pcs.forEach(p=>{ p.x+=p.vx; p.y+=p.vy; p.vy+=0.05; p.rot+=p.vr; ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.rot); ctx.fillStyle=p.col; ctx.fillRect(-p.r/2,-p.r/2,p.r,p.r); ctx.restore(); });
    if(t++<180) requestAnimationFrame(a); else c.remove();
  })();
}

/* interaction fiable */
let start=null, lastPreview=[];
const posFromEl = el => { const i=+el.dataset.index; return {r:Math.floor(i/N), c:i%N}; }
const clearPreview = ()=>{ lastPreview.forEach(p=>cells[idx(p.r,p.c)].classList.remove('preview','valid-preview')); lastPreview=[]; }
function setPreview(L, exact=false){
  clearPreview(); if(!L) return;
  L.forEach(p=>cells[idx(p.r,p.c)].classList.add(exact?'valid-preview':'preview'));
  lastPreview=L.slice();
}
gridEl.addEventListener('pointerdown', e=>{
  const t=e.target.closest('.cell'); if(!t) return;
  ensureAudio(); clickFx(); e.preventDefault(); gridEl.setPointerCapture(e.pointerId);
  start=posFromEl(t); setPreview([start], false);
});
gridEl.addEventListener('pointermove', e=>{
  if(!start) return;
  const el=document.elementFromPoint(e.clientX, e.clientY);
  const cell=(el && el.classList && el.classList.contains('cell'))? el : e.target.closest('.cell');
  if(!cell) return;
  const end=posFromEl(cell);
  const L=collectLine(start,end);
  if(!L){ clearPreview(); return; }
  const exact=isExact(L);
  if(exact) setPreview(L,true);
  else if(isPrefix(L)) setPreview(L,false);
  else clearPreview();
});
function commitIfValid(){
  if(!start || !lastPreview.length) return;
  const exactName=isExact(lastPreview);
  if(exactName){
    remaining.delete(exactName);
    lastPreview.forEach(p=>gridEl.children[idx(p.r,p.c)].classList.add('found','flash'));
    markBadgeFound(exactName); updateStatus(); playDing();
    if(remaining.size===0){ statusEl.textContent="Ø±Ø§Ø¦Ø¹! âœ…"; playWin(); }
    applyHints();
  }
  clearPreview(); start=null;
}
gridEl.addEventListener('pointerup',    ()=>commitIfValid());
gridEl.addEventListener('pointercancel',()=>{ clearPreview(); start=null; });

/* hints */
function applyHints(){
  for(let r=0;r<N;r++)for(let c=0;c<N;c++){
    const i=idx(r,c), el=cells[i], found=el.classList.contains('found');
    el.classList.toggle('hint', hintsOn && isWord[r][c] && !found);
  }
}
btnHints.onclick=()=>{ hintsOn=!hintsOn; btnHints.setAttribute('aria-pressed', hintsOn?'true':'false'); applyHints(); };

/* contrÃ´les */
selSize.onchange=()=>{ N=+selSize.value; generate(); }
selChunk.onchange=()=>{ CHUNK=+selChunk.value; generate(); }
selCat.onchange=generate;
selDiff.onchange=generate;
chkDiag.onchange=()=>{ allowDiag=chkDiag.checked; generate(); }
btnRegen.onclick=generate;

/* fit */
function sizeGridWrap(){
  const header=document.querySelector('header');
  const wrap=gridEl.parentElement;
  const H=Math.max(280, window.innerHeight - header.getBoundingClientRect().height - 32);
  wrap.style.setProperty('--gridH', H+'px');
}
function fitGrid(){
  const wrap=gridEl.parentElement, styles=getComputedStyle(gridEl);
  const gap=parseFloat(styles.gap)||0, W=wrap.clientWidth-4, H=wrap.clientHeight-4;
  const cW=(W-gap*(N-1))/N, cH=(H-gap*(N-1))/N;
  document.documentElement.style.setProperty('--cell', Math.floor(Math.max(22, Math.min(cW, cH)))+'px');
}
function refitAll(){ sizeGridWrap(); fitGrid(); }
addEventListener('resize', refitAll);
new ResizeObserver(refitAll).observe(document.body);

/* init */
allowDiag=false; selCat.value="Ø§Ù„Ø£Ù„ÙˆØ§Ù†"; generate(); refitAll();
</script>
</body>
</html>
